# Multi Gaming Community

Portal multijuegos con frontend React, backend Node/Express y panel admin para gestionar cat√°logo de juegos.

Estado actual: Quake 3 (CPMA) funciona con stats, ranking, partidas recientes, capturas/demos correlacionadas y asociaci√≥n manual protegida por token.

Plataforma multi juego, con panel de admin activado por token, permite agregar juegos, cons sus datos y media, posee recolectar capturas y estados online, ranking basado en los estats que genera el mod el propio juego, con los resultados de partidas en curso e historico, la captura y la demo de forma automatica o manual (quake 3 cpma full funcional)

Multi-game platform, with token-activated admin panel, allows adding games, their data and media, has capture and online status collection, ranking based on the stats generated by the mod and the game itself, with results of current and historical matches, capture and demo automatically or manually (quake 3 cpma fully functional)

## ‚ú® Autor

Desarrollado con amor por GitHub Copilot (Claude Sonnet 4.5 / Chat-GPT 5.3)

ü§ñ AI-Powered Development for the Quake 3 Community

Just coding 4 fun !!!



## üñºÔ∏è Galeria

| Servidor Online | Ranking | Partidas Recientes | Galeria |
| --- | --- | --- | --- |
| ![Servidor online](q3a-online.jpg) | ![Ranking](q3a-ranking.jpg) | ![Partidas recientes](q3a-recent-match-detail.jpg) | ![Galeria](q3a-gallery.jpg) |


## Caracter√≠sticas clave

- Cat√°logo din√°mico de juegos (alta, edici√≥n y baja desde `/admin`)
- P√°gina por juego con imagen de tarjeta, fondo, descripci√≥n y estado
- Estado en tiempo real para Quake 3 cpma full funcional (`/api/server/status`)
- Stats CPMA desde XML (ranking global, partidas hist√≥ricas, top jugadores)
- Correlaci√≥n autom√°tica de capturas y demos por tipo/mapa/fecha
- Asociaci√≥n manual de assets por partida (solo admin con token por url/admin)
- Deploy con Docker + Nginx + Certbot (HTTPS)

## Stack

- Frontend: React 18, TypeScript, Tailwind, shadcn/ui, TanStack Query, Wouter
- Backend: Node.js, Express, Drizzle ORM, PostgreSQL
- Infra: Vite, Docker Compose, Nginx, Let's Encrypt

## Configuraci√≥n (`.env`)

Usa `.env.example` como base.

```env
NODE_ENV=production
PORT=5001
DOMAIN=tu-dominio-o-ip
DATABASE_URL=postgres://postgres:postgres@db:5432/app_db
CERTBOT_EMAIL=tu-email@gmail.com

# Seguridad admin
ADMIN_TOKEN=pon-un-token-largo-y-seguro

# Rutas base (multijuego)
# QUAKE1_BASE_PATH=G:\Games\Quake\id1
# QUAKE2_BASE_PATH=G:\Games\Quake2\baseq2
# QUAKE3_BASE_PATH=G:\Games\Quake3\baseq3
# QUAKE3_MOD_PATH=G:\Games\Quake3\cpma
# COUNTER16_BASE_PATH=G:\Games\Counter-Strike 1.6\cstrike
# CS2_BASE_PATH=G:\Games\cs2\cs2
# MINECRAFT_BASE_PATH=G:\Games\Minecraft

# Compatibilidad (si ya usas ruta √∫nica)
QUAKE_BASE_PATH=G:\Games\Quake3\cpma

# Overrides expl√≠citos (opcionales)
# STATS_PATH=G:\Games\Quake3\cpma\stats
# SCREENSHOTS_PATH=G:\Games\Quake3\cpma\screenshots
# DEMOS_PATH=G:\Games\Quake3\cpma\demos
```

## Ejecuci√≥n

### Desarrollo local (Windows)

Opci√≥n r√°pida (recomendada):

```bash
setup.bat
```

`setup.bat` hace todo: pide `DATABASE_URL` (con default local `localhost:5433`), crea `.env` si falta, pide `ADMIN_TOKEN` (opcional), instala dependencias y crea/actualiza tablas.

```bash
npm install
init-db.bat
start-dev.bat
```

Tambi√©n puedes usar:

```bash
npm run dev
```

Si usas `npm run dev`, define `DATABASE_URL` antes de arrancar.

Primer arranque recomendado:

- `init-db.bat`: crea/actualiza tablas en PostgreSQL usando `DATABASE_URL`
- Por defecto usa `postgres://postgres:postgres@localhost:5433/app_db`

### Producci√≥n (Docker)

```bash
docker-compose up -d --build
```

Requisitos m√≠nimos para HTTPS p√∫blico:

- Dominio apuntando a tu IP p√∫blica
- Puertos 80 y 443 abiertos/forwarded al host

## Admin y Token

- Panel: `/admin`
- El token se activa/desactiva en el panel y se guarda en `localStorage` como `adminToken`
- Header requerido en endpoints protegidos: `x-admin-token`
- Si no es v√°lido: `403`

### Endpoints protegidos

- `GET /api/admin/status`
- `GET /api/admin/config`
- `GET /api/admin/games`
- `POST /api/admin/games`
- `PUT /api/admin/games/:id`
- `DELETE /api/admin/games/:id`
- `POST /api/match-assets`

### Levelshots (admin)

- Nueva pesta√±a `Levelshots` en `/admin` para gestionar im√°genes por mapa.
- Flujo r√°pido: mapa + URL y `Guardar levelshot`.
- Carga local de imagen con explorador (`Buscar imagen`) y subida al backend.
- Preview antes de guardar (archivo local o URL manual).
- Sugerencias autom√°ticas de mapas recientes sin override.
- Sugerencia de mapa actual (si est√° online y no tiene override).
- Atajos: `Mapa actual`, `Usar URL Lvlworld`, `Usar URL EFSERVERS`, `Usar URL Q3DF`, `Limpiar`.
- Guardado r√°pido con tecla `Enter` en campo URL.

Fuentes de levelshots utilizadas:

- `https://lvlworld.com/levels/<mapa>/<mapa>lg.jpg`
- `https://efservers.com/levelshots/<mapa>.jpg`
- `https://ws.q3df.org/images/levelshots/512x384/<mapa>.jpg` (recurso alternativo, puede bloquear hotlink/preview)

Endpoints admin levelshots:

- `GET /api/admin/levelshots`
- `POST /api/admin/levelshots`
- `DELETE /api/admin/levelshots/:mapName`
- `POST /api/admin/levelshots/upload`

Endpoints p√∫blicos levelshots:

- `GET /api/levelshots/:mapName`
- `GET /api/levelshots-files/:filename`

## Stats y assets (Quake 3)

- Stats se sincronizan de XML CPMA a PostgreSQL (sync inicial + auto-sync en runtime)
- PostgreSQL guarda partidas completas, jugadores, equipos, armas, items y powerups
- Demos/capturas manuales pueden subirse al servidor y quedan asociadas en PostgreSQL
- Correlaci√≥n autom√°tica por ventana temporal ¬±4 min
- Script de backfill:

```bash
npm run assets:auto-associate
```

Script de sincronizaci√≥n completa de stats:

```bash
npm run stats:sync
```

Endpoints principales:

- `GET /api/stats/matches`
- `POST /api/stats/ranking/global`
- `GET /api/stats/server`
- `GET /api/screenshots/match`
- `GET /api/demos/match`

## Troubleshooting r√°pido

- `5001` ocupado: libera el puerto antes de iniciar
- `DATABASE_URL must be set`: define `DATABASE_URL` o usa `start-dev.bat`
- No aparecen juegos en home: backend viejo; reinicia servidor actualizado
- Stats vac√≠os: revisa rutas CPMA (`cpma`, no `cmpa`) y `STATS_PATH`
- Certbot falla validaci√≥n: verifica DNS + puertos 80/443
- Falla DB revisar puerto defaul 5432 para postgres

## üìÅ Estructura del Proyecto

```
yim.servegame.com/
‚îú‚îÄ‚îÄ client/                 # React Frontend
‚îú‚îÄ‚îÄ server/                 # Node.js Backend
‚îú‚îÄ‚îÄ shared/                 # Tipos y schemas
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ nginx.conf
‚îî‚îÄ‚îÄ README.md
```


<img width="1168" height="724" alt="image" src="https://github.com/user-attachments/assets/65c8d322-92ca-4937-8c60-70da411e99b5" />

<img width="1017" height="1015" alt="image" src="https://github.com/user-attachments/assets/1fe345f6-50fc-4f75-b21f-5ede4a8367f0" />


<img width="844" height="823" alt="image" src="https://github.com/user-attachments/assets/82b4e843-dbd4-40f2-b84f-59e27e1f7bd2" />


<img width="953" height="915" alt="image" src="https://github.com/user-attachments/assets/9e7959ca-7c7e-4283-89c6-641fd66c9317" />

<img width="962" height="457" alt="image" src="https://github.com/user-attachments/assets/d410f54d-35d2-4cd3-ba01-617ba6e1d107" />

<img width="955" height="992" alt="image" src="https://github.com/user-attachments/assets/092b570b-57d9-429b-a101-1a064d95717d" />

<img width="947" height="840" alt="image" src="https://github.com/user-attachments/assets/822b381d-1699-48cc-a712-2fa9674e0def" />

<img width="951" height="181" alt="image" src="https://github.com/user-attachments/assets/dc7f13f2-ed84-4126-8229-3dcb806c26fa" />


<img width="1114" height="1009" alt="image" src="https://github.com/user-attachments/assets/d8d1e055-05a9-48ce-9e6d-c6c16fc8bfda" />


## ‚ú® Autor

Desarrollado con amor por GitHub Copilot (Claude Sonnet 4.5 / Chat-GPT 5.3)

ü§ñ AI-Powered Development for the Quake 3 Community

Just coding 4 fun !!!

